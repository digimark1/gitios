<!DOCTYPE html>
<html>
  <head>
    <title>Smith Track'n Go App</title>
    <meta charset="utf-8">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">-->
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">-->
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
     <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
     <link rel="stylesheet" href="css/loginstyle1.css" />
     <link href='https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:400,300,200,700' rel='stylesheet' type='text/css'>
    <style>
				
	</style>
    <script type="text/javascript">
		var myScroll;
		var myScroll_message;
		function loaded () {
		myScroll = new iScroll('bol_image', {
				zoom: true,
				bounce:false
			});
		}
		//test-a-document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
		document.addEventListener('DOMContentLoaded', loaded, false);
</script>
	 <script src="js/jquery-1.11.3.min.js"></script> 
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script> 
    <script type="text/javascript" src="PushNotification.js"></script>
    <!-- IScroll 5 -->
    <!-- <script type="text/javascript" src="js/iscroll-zoom.js"></script> -->
    <!-- IScroll 4 -->
    <script type="text/javascript" src="js/new/iscroll.js"></script>
    <script type="text/javascript" charset="utf-8">
	var panel = '<div data-role="panel" id="mypanel" data-position="left" data-display="overlay" style="width:90%" data-theme="a"><ul data-role="listview" data-theme="d"><li><div><a style="color:red" href="#" data-rel="close"><img width="60%" src="css/logo.png" style="margin-top:0px; margin-bottom:0px"/></a></div><div id="full_name0_2"></div></li><li><a style="color:#333;background-color:#F6F6F6" data-rel="close" onClick="active_loads()">ACTIVE LOADS</a></li><li><a style="color:#333;background-color:#F6F6F6" onClick="load_history()" data-rel="close">LOAD HISTORY</a></li><!--<li id="callcheck_li"><a style="color:#333;background-color:#F6F6F6" href="#page4" data-rel="close">CALL CHECKS</a></li>--><li><a href="#" id="" style="color:red" onClick="signout_function()" data-rel="close">Sign Out</a></li></ul></div>';
$(document).one('pagebeforecreate', function () {
    $.mobile.pageContainer.prepend(panel);
    $("#mypanel").panel().enhanceWithin();
});
    // Wait for device API libraries to load
    //
	var pushNotification;
    document.addEventListener("deviceready", onDeviceReady, false);
    // device APIs are available
				function onDeviceReady() {
					 navigator.splashscreen.hide();
					 // base url for dashboard
					 localStorage.base_url = 'http://leanstaffing.com/trackngo2';
					 // Url to save data into database
					 localStorage.save_url = 'http://leanstaffing.com/testserver2';
					 localStorage.files = 'http://leanstaffing.com/tkgo_files2';
					 localStorage.load_hid;
					 localStorage.load_id_bol;
					 localStorage.start;
					 localStorage.finish;
					 localStorage.user_id;
					 localStorage.trace;
					 localStorage.name;
					 localStorage.message;
					 localStorage.comment;
					 localStorage.inactive;
					 localStorage.camera;
					 localStorage.pages;
					 localStorage.cont_pages;
					 localStorage.bol_number;
					 localStorage.active_shipment;
					 localStorage.save_bol;
					 localStorage.load_number;
					 localStorage.pick_address;
					 //using, but testing the blank issue /// /// localStorage.token;
					 //localStorage.test2;
					 //localStorage.msg;
					 //localStorage.bol;
	
					 screen.lockOrientation('portrait');
					 console.log(navigator.camera);
	
					 navigator.geolocation.getCurrentPosition(onSuccess, onError, {timeout:10000});
					 //Push Notification
					 try 
							{ 
								pushNotification = window.plugins.pushNotification;
										$("#app-status-ul").append('<li>Registering ' + device.platform + '</li>');
								if (device.platform == 'android' || device.platform == 'Android' || device.platform == 'amazon-fireos' ) {} else {
									pushNotification.register(tokenHandler, errorHandler, {"badge":"true","sound":"true","alert":"true","ecb":"onNotificationAPN"});	// required!
								}
							}
							catch(err) 
							{ 
								txt="An error has ocurred .\n\n"; 
								txt+="Error Description: " + err.message + "\n\n"; 
								alert(txt); 
							}
					// CDV background location adjustment
					
					var bgGeo = window.plugins.backgroundGeoLocation;
	
					var callbackFn = function(location){
					
						};
						 
						var failureFn = function(error){
							navigator.notification.alert(
								  'Geolocation Error',
								  alertCallback,
								  'Smith TracknGo',
								  'Ok');
							
						};
					
					bgGeo.configure(callbackFn, failureFn, {
						desiredAccuracy: 0,
						stationaryRadius: 10,
						distanceFilter: 10,
						stopOnTerminate: true,
						debug: false //changed to false to avoid notifications
					});
					// ENd of CDV background location adjustment
					bgGeo.start();
					
				}
    // onSuccess Geolocation
    //
    function onSuccess(position) {

	//l-ocalStorage.trace = 1;
	
	//----End of background settings	
	cordova.plugins.backgroundMode.setDefaults({

		});
		
	cordova.plugins.backgroundMode.enable();
	
        var element = document.getElementById('geolocation');
        element.innerHTML = '<input type="hidden" id="latitude" name="latitude" value="'           + position.coords.latitude              + '"  /><br />' +
                            '<input type="hidden" id="longitude" name="longitude" value="'          + position.coords.longitude             + '" /><br />' ;
	
				if(!localStorage.user_id){
					location.href='#page1';
					$('#loading_start').hide();
					//alert('device ready and needs the user');
					}else{
						//alert('device ready for app use');
						if(localStorage.location_mark == 1){
						        localStorage.location_mark = 0;
								location.href='#page1_1';
							}else{
								location.href='#page1_1';
								};
						if(localStorage.finish == 0){
							      localStorage.tobecontinued = 1;
								  //alert('localStorage.finish ==0');
								  active_shipments_load(localStorage.last_active_load, localStorage.last_active_load_number);
							}else{
								  localStorage.tobecontinued = 0;
								  location.href='#page1_1';
								};
						setTimeout(function(){
							 $('#loading_start').hide();
							 $('#full_name').html(localStorage.name);
							 $('#full_name1').html(localStorage.name);
							 $('#full_name0_2').html(localStorage.name);
							//$('#full_name2').html(data[i].full_name);
							 $('#full_name3').html(localStorage.name);
							 $('#full_name4').html(localStorage.name);
							 $('#full_name5').html(localStorage.name);
							 $('#full_name6').html(localStorage.name);
							//20151007
							//active_load(localStorage.user_id);
						},0);
					}
    }
    // onError Callback receives a PositionError object
    //
    function onError(error) {
		navigator.notification.alert(
								  'Please Turn On your GPS and  ' + '\n' +
              						'start the App Again '+'\n',
								  alertCallback,
								  'Smith TracknGo',
								  'Ok');
    }
//------------------------------- handle GCM notifications for Android -------------------------------------------
//------------------------------------------------------------------------
//------------------------------------------------------------------------
				////////////////
				////////
				////////
				 // handle GCM notifications for Android
            function onNotification(e) {}
			
///////--------------------------------------
///////--------------------------------------
///////--------------------------------------		
///////--------------------------------------NOTIFICATION IPHONE----------------------------------////////////
///////--------------------------------------
///////--------------------------------------
///////--------------------------------------
			
			function onNotificationAPN(e) {
                if (e.alert) {
                     // showing an alert also requires the org.apache.cordova.dialogs plugin
						//navigator.notification.alert(e.alert);
					 $('#ios_notification').html(e.alert);
							
						//------ SENDING TO LOAD ON NOTIFICATION-----//
						
							var load_str = e.alert;
							var load_sub = load_str.substring(0, 10);
							
							 //---- MESSAGE LOAD # ---
							 
							if(load_sub == "Msg load #" ){
								$("#image_source").attr('src','css/loading2.gif');
								var load_sub_split = load_str.split("-");
								var load_number = parseFloat(load_sub_split[0].substring(10,20));
								
								// alert(load_title_push);
									 $.ajax({
									 type: 'POST',
									 dataType: 'json',
									 async:false,
									 url: ''+localStorage.base_url+'/load/app_get_load_by_driver/'+localStorage.user_id,
									 //http://leanstaffing.com/trackngo/load/app_get_load_view/
										success: function(data){
											console.log(data);
											for(i=0;i<data.length;i++){
												if (data[i].load_number == load_number){
														localStorage.load_id_bol = data[i].idts_load;
														$('#load_number_hid').html(data[i].load_number);
														$("#header_load").html('BOL # :'+'<a id="bol" href="#" x-apple-data-detectors="false">'+data[i].bol_number+'</a>');
														$("#bol_number_hid").html(data[i].bol_number);
														localStorage.load_number = data[i].load_number;
														//$('#consignee_button').html('<a href="#" id="sig_button2" name="b" onClick="consignee_alert()"><img src="css/button3.png" width="100%"/></a>');
														//localStorage.msg = 1;
														view_bol();
													}
												}
												//localStorage.msg = 1;
												//localStorage.test2 = 1;
												 //alert('1call:'+$('#load_hid').html());
										}
										})
								//
								 // load_details3($('#load_hid').html());
								 
								  setTimeout(function(){
									location.href = "#page4";
							 		//localStorage.msg = 0;
							      },100) 
								 
								} 
							 
							 //---- LOAD #
							if (load_sub == "New load #"){
								localStorage.start ="";
								localStorage.finish = 0;
								localStorage.inactive = 0;
								//localStorage.load_hid ="";
								localStorage.load_hid = 1;
								$("#image_source").attr('src','css/loading2.gif');
								var load_sub_split = load_str.split("-");
								var load_number = parseFloat(load_sub_split[0].substring(10,20));
								//alert(load_push);
									 $.ajax({
									 type: 'POST',
									 async: false,
									 dataType: 'json',
									 url: ''+localStorage.base_url+'/load/app_get_load_by_driver/'+localStorage.user_id,
										success: function(data){
											console.log(data);
											for(i=0;i<data.length;i++){
												if (data[i].load_number == load_number){
														localStorage.load_id_bol = data[i].idts_load;
														localStorage.last_active_load = localStorage.load_id_bol;
														$('#load_number_hid').html(data[i].load_number);
														localStorage.last_active_load_number = data[i].load_number;
														//$("#header_load").html('BOL # :'+'<a id="bol" href="#" x-apple-data-detectors="false">'+data[i].bol_number+'</a>');
														$("#bol_number_hid").html(data[i].bol_number);
														//$('#consignee_button').html('<a href="#" id="sig_button2" name="b" onClick="consignee_alert()"><img id="img_gps" src="css/button3.png" width="100%"/></a>');
														//$('#shipper_button').html('<a href="#page3" id="sig_button1" name="a" class=""><img src="css/button2.png" width="100%"/></a>');
														//localStorage.bol = 1;
														active_shipments_load(data[i].idts_load,data[i].load_number);
														//view_bol();
													}
												}
												//localStorage.test2 = 1;
												$('#validate_').html(1);
												//localStorage.bol = 1;
												//alert('2call:'+$('#load_hid').html());
										}
										})
								//active_load(localStorage.user_id);
								  //load_details2($('#load_hid').html());
								 
								   setTimeout(function(){
									    location.href = "#page2";
							 			//localStorage.bol = 0;
							      },100) 
								   
								}
					}
                    
                if (e.sound) {
                    // playing a sound also requires the org.apache.cordova.media plugin
                    var snd = new Media(e.sound);
                    snd.play();
					 //$('#ios_notification1').html('HELLO WORLD');
                }
                
                if (e.badge) {
                    pushNotification.setApplicationIconBadgeNumber(successHandler, event.badge);
                }
            }
            
            function tokenHandler (result) {
				localStorage.token = result;
				// Your iOS push server needs to know the token before it can push to this device
				// here is where you might want to send it the token for later use.
				//alert('device token = ' + localStorage.token);
				$('#token_device_hid').html(result);
				
            }
			
            function successHandler (result) {
            }
            function errorHandler (error) {
            }
    </script>
 
  </head>
  <body>
   <div data-role="page" id="page0">
   		<div id="ios_notification" hidden></div>
        <div id="cam_picture" hidden></div>
   		<div id="token_device_hid" hidden></div>
        <div data-role="header">
                  <div style="background-color: rgb(255, 255, 255); padding-top: 5%;"></div>       	
                    <table width="100%">
                          <tr>
                            <td width="45%"><div><img width="100%" src="css/logo.png" style="margin-top:0px; margin-bottom:0px"/></div></td>
                            <td align="right" valign="top" style="padding:5px"><!--<div id="full_name6"></div><div><a href="#" id="signout6" style="color:red">Sign Out</a>--></td>
                          </tr>
                      </table>
        </div>
                        <div style="width:100%"><table width="100%"><tr><td width="50%"><img id="" src="css/active_active.png" width="100%"></td><td width=50%><img id="" src="css/history_inactive.png" width="100%"></td></tr></table></div>
                    	<div role="listpage" class="ui-content" id="">
                        <div id=""><img src="css/loading.gif" style="width:20%;margin-left:40%;" /></div>
                     </div>
             <!-- register id for push notifications -->
               <div id="" hidden></div>
    </div>
    
  <div data-role="page" id="page1">
  	<div data-role="header">
    <div style="background-color: rgb(255, 255, 255); padding-top: 5%;"></div>
    	<table width="100%">
          <tr>
    		<td><div><img width="50%" src="css/logo.png" style="margin-top:0px; margin-bottom:0px"/></div></td>
            <td align="right" valign="top"><div id=""></div><div><a href="#" id="" style="color:red"></a></div></td>
    	  </tr>
        </table>
    </div>
  	<div class="inputstyle">
  		<div role="main" class="ui-content">
        	<p id="geolocation">Finding geolocation...</p>
                <div>
                    <input type="tel" id="user_name" name="user_name" value="" placeholder="phone number" />
                </div>
                <div id="hid_uid" hidden></div>
                <br />
            	<div id="start_button"><a href="#" id="login_phone" name="login_phone" class="btn-class-send2">START</a></div>
                <div id="loading_start"><img src="css/loading.gif" style="width:8%;margin-left:45%;" /></div>
     	</div>
     </div>
   </div>

  <div data-role="page" id="page1_1"> 
  				<div data-role="header" data-position="fixed" data-tap-toggle="false"> 
                <div style="background-color: rgb(255, 255, 255); padding-top: 5%;"></div>      	
             	    	<table width="100%" style="background-color:#ED1A3B">
                              <tr>
                                <td width="15%" style="padding-left:5px"><div><a href="#mypanel"><img width="100%" src="css/menu_button.png" style="margin-top:0px; margin-bottom:0px"/></a></div></td>
                                <td><div id="title0">TRACKN'GO!</div></td>
                                <td align="right" valign="top" style="padding:5px"><div id=""></div></td>
                              </tr>
                          </table>
                 </div>
                        <div style="width:100%"><table width="100%"><tr><td width="50%"><img id="active_ld" src="css/active_active.png" width="100%"></td><td width=50%><img id="history_ld" src="css/history_inactive.png" width="100%"></td></tr></table></div>
                    	<div role="listpage" class="ui-content" id="lol">
                        <table width="100%" id="lol_item"></table>
                        <table id="lol_item_inactive"></table>
                        <div id="loading_loads"><img src="css/loading.gif" style="width:20%;margin-left:40%;" /></div>
                     </div>
             <!-- register id for push notifications -->
               <div id="reg_id" hidden></div>

    </div>
    
    <!-- List of SHIPMENTS -->
    
    <div data-role="page" id="page2">

  				<div data-role="header" id="header2" data-position="fixed" data-tap-toggle="false"> 
                <div style="background-color: rgb(255, 255, 255); padding-top: 5%;"></div>      	
             	    	<table width="100%" style="background-color:#ED1A3B">
                              <tr>
                                <td width="15%" style="padding-left:5px"><div><a href="#mypanel"><img width="100%" src="css/menu_button.png" style="margin-top:0px; margin-bottom:0px"/></a></div></td>
                                <td><div id="title1">TRACKN'GO!</div></td>
                                <td align="right" style="padding:5px"><div id="load_shipment"></div></td>
                              </tr>
                          </table>
                 </div>
                        <div style="width:100%"><table width="100%"><tr><td width="50%"><img id="active_shp" src="css/active_shipments.png" width="100%"></td><td width=50%><!--<img id="history_shp" src="css/history_inactive.png" width="100%">--></td></tr></table></div>
                    	<div role="listpage" class="ui-content" id="lol_shipment">
                        <table width="100%" id="lol_item_shipment"></table>
                        <table id="lol_item_shipment_inactive"></table>
                        <div id="loading_shipments"><img src="css/loading.gif" style="width:20%;margin-left:40%;" /></div>
                     </div>
               <div data-role="footer" data-position="fixed"> 
                       <table style="width: 100%; border-collapse:collapse">
                            <tr style="background-color:#ED1A3B">
                                <td style="width: 25%;text-align: center;"><div><a href="#page1_1" id="" class=""><img width="80%" src="css/back_pic.png"></a></div></td>
                                <td style="width: 25%;"><div id="shipper_button0"><!--<a href="" id="sig_button11" name="a" class=""><img src="css/button2.png" width="100%"/></a>--></div></td>
								<td style="width: 25%;"><div id="consignee_button0"><!--<a href="" id="sig_button22" name="b" class=""><img id="img_gps" src="css/button3.png" width="100%"/></a>--></div></td>
                                <td style="width: 25%;"><div><a href="" id="" name="b" class="" onClick=""><!--<img src="css/button4.png" width="100%"/>--></a></div></td>
                            </tr>
                       </table>
                </div>
               
    </div>
    
 	<div data-role="page" id="page2_5">
             	    <div data-role="header">
                    <div style="background-color: rgb(255, 255, 255); padding-top: 5%;"></div>
                    <div>
                    <table width="100%" style="background-color:#ED1A3B">
                              <tr>
                                <td width="15%" style="padding-left:5px"><div><a href="#mypanel"><img width="100%" src="css/menu_button.png" style="margin-top:0px; margin-bottom:0px"/></a></div></td>
                                <td><div id="title2">TRACKN'GO!</div></td>
                                <td align="right"  style="padding:5px"><div id="load_shipment1"></div></td>
                              </tr>
                          </table>
                    </div>
                    <div>
                        <div id="header_load">&nbsp;_</div><div id="header_load_pages">&nbsp;_</div>
                     </div>
                        <div style="width:100%;line-height: 0.3;"><table width="100%"><tr><td width="34%"><img id="digital_bol" src="css/digital_active.png" width="100%"></td><td width="33%"><img id="picture_bol" src="css/picture_inactive.png" width="100%"></td><td width="33%"><img id="direction_bol" src="css/places_inactive.png" width="100%"></td><!--<td width="25%"><img id="chat_bol" src="css/chat_inactive.png" width="100%"></td>--></tr></table>
                        </div>
                        <div id="doc_options"><img id="menu1" src="css/chat_inactive.png" width="100%"></div>
                        <div style="display:inline-block;line-height: 0.3;">
                            <table id="table_pager">
                            <tr><td><div id='lastpage'><img id="lastpage_im" src="css/button5_s.png" width="100%"></div><td></td></td><td align="center"><div id="middle_number">1</div></td><td></td><td><div id='nextpage'><img id="nextpage_im" src="css/button4_s.png" width="100%"></div></td></tr>
                            </table>
                        </div>
                 </div>
                
                <div id="bol_image">
                    <img id="image_source" alt="" src="css/loading2.gif" style="width:100%;padding-top:2px;"/>
                </div>
                <div id="pick_drop">
                  <!--<p>PickUp Location: <a style="color:red" href="maps://?q=cupertino"; onclick="window.open(this.href,'_system'); return false;">EverGreen Street 1600</a></p>-->
                  <div id="pick_div">
                      <div id="pick_div_text">
                         <p><span id="pick_location_title">PickUp Location: </span><span id="pickup_text">Address</span></p>
                         <p><a style="color:red" onClick="location.href=localStorage.pick_address" target="_system">OPEN IN MAP</a></p>
                      </div>
                      <div id="pick_div_im">
                          <a style="color:red" onClick="location.href=localStorage.pick_address" target="_system"><img id="pick_map_icon" src="css/maps-icon1.png"/></a> 
                      </div>
                   </div>
                   <br>
                   <div id="drop_div">
                      <div id="drop_div_text">
                          <p><span id="drop_location_title">Drop Location: </span><span id="drop_text">Address</span></p>
                          <p><a style="color:red" onClick="location.href=localStorage.drop_address" target="_system">OPEN IN MAP</a></p>
                       </div>
                       <div id="drop_div_text">
                          <a style="color:red" onClick="location.href=localStorage.pick_address" target="_system"><img id="drop_map_icon" src="css/maps-icon2.png"/></a> 
                      </div>
                    </div>
                </div>
                <div id="screenheight" hidden></div>
                <div id="screenheight2" hidden></div>
                <div data-role="footer" data-position="fixed" >
                 <div id="picture_buttons">
                       <table width="100%">
                              <tr>
                                <td style="width: 25%;"><div id="load_list_button"><a href="#page2" id="back" class="" onClick=""><img src="css/back_pic.png" width="80%" /></a></div></td>
                                <td width="25%"><div id="take_photo_button"><img id="upload_picture" src="css/take_pic.png" width="100%"/></div></td>
                                <td width="25%"><div id="save_pic"><img id="save_picture" src="css/save_pic.png" width="100%"/></div></td>
                                <!--<td width="25%"><div><button id="save_bol" value="button">Save<br>BOL</button></div></td>-->
                                <!--<td align="right" valign="top" style="padding:5px"><div hidden="" id="full_name1"></div><div hidden=""><a href="#" id="signout1" style="color:red">Sign Out</a></div></td>-->
                               <td width="25%"><img id="chat_bol" src="css/chat_pic.png" width="100%"></td><!--<div id="next_page"><img id="change_next_page" src="css/button4.png" width="100%"/></div>--></td>

                              </tr>
                          </table> 
                      </div>
                    <div id="digital_buttons">
                       <table style="width: 100%; border-collapse:collapse">
                            <tr style="background-color:#ED1A3B">
                                <td style="width: 25%;"><div id="load_list_button"><a href="#page2" id="back" class="" onClick=""><img src="css/back_pic.png" width="80%" /></a></div></td>
                                <td style="width: 25%;"><div id="shipper_button"><a href="#page3" id="sig_button1" name="a" class=""><img src="css/button2.png" width="80%"/></a></div></td>
								<td style="width: 25%;"><div id="consignee_button"><a href="#page5" id="sig_button2" name="b" class=""><img id="img_gps" src="css/button3.png" width="80%"/></a></div></td>
                                <td style="width: 25%;"><img id="chat_bol2" src="css/chat_pic.png" width="80%"></td><!--<div id="next_page2"><img id="change_next_page2" src="css/button4.png" width="80%"/></div>--></td>
                            </tr>
                       </table>
                     </div>
                   <div id="load_id_hidden" hidden></div>
                   <div id="load_number_hid" hidden></div>
                   <div id="bol_number_hid" hidden></div>
                </div> 
       </div>
       
           <!----------- --------> 
     <div data-role="page" id="page3">
     
			<div data-role="header">
              <div style="background-color: rgb(255, 255, 255); padding-top: 3%;"></div>       	
                <table width="100%">
                      <tr>
                        <td width="26%"><div><img width="100%" src="css/logo.png" style="margin-top:0px; margin-bottom:0px"/></div></td>
                        <td align="right" valign="top" style="padding:5px"><div id="full_name3"></div><div><a href="#" id="signout3" style="color:red">Sign Out</a></div></td>
                      </tr>
                  </table>
            </div>
            <div id="signature_bg">
                <div>
                	<div style="display: inline-block; margin-bottom: 7px; margin-top:2px" id="header_signature_1"></div>
                    <div style="display: inline-block;float: right;text-align: right;margin-top: 4px;"><a href="#" id="clear_sig1" class=""><img width="50%" src="css/signature-clear-action.png"></a></div>
                </div>
                <div id="content_s">
                	<div id="page3_tr">
                    <div id="page3_tr_bk">
                        <div id="signatureparent">
                            <div id="signature"></div>
                        </div>
                     </div>
                    </div>
                </div>
                <div id="please_shipper">
                	 PLEASE ENTER SHIPPER SIGNATURE
                </div>
                <div>
                    <div id="signature_button">
                        <table id="sig_table_1">
                            <tr>
                                <td width="33%" ><div><a href="#" id="back3" onClick="close_sig()" class=""><img width="40%" src="css/signature-back-action.png"></a></div></td>
                                <td width="34%"><div class="width_buttons"><a href="#" id="save_signature" class=""><img width="80%" src="css/signature-save-action.png"></a></div></td>
                                <td width="33%" ><div class="width_buttons"><a href="#" id="back3_1" onClick="close_sig()" class=""><img width="40%" src="css/signature-cancel-action.png"></a></div></td>
                            </tr>
                        </table>
                     </div>
                     <div id="loading_signature"><img src="css/loading.gif" style="width:8%;margin-left:45%;" /></div>
                </div>
              </div>
      
      </div>
            <!----------- -------->
            
            <div hidden><input type="hidden" id="hidden_Signature" name="hidden_Signature" />
            </div>
            <div id="signature_print" hidden></div>
    </div>
    <div data-role="page" id="page5">
    <div data-role="header" data-position="fixed" data-tap-toggle="false">
              <div style="background-color: rgb(255, 255, 255); padding-top: 3%;"></div>       	
                <table width="100%">
                      <tr>
                        <td width="24%"><div><img width="100%" src="css/logo.png" style="margin-top:0px; margin-bottom:0px"/></div></td>
                        <td align="right" valign="top" style="padding:5px"><div id="full_name5"></div><div><a href="#" id="signout5" style="color:red">Sign Out</a></div></td>
                      </tr>
                  </table>
            </div>

            <div id="signature_bg2">
            	<div style="padding-top: 4px;">
                	<div style="display: inline-block; margin-bottom: 7px; margin-top:2px" id="header_signature_2"></div>
                    <div style="display: inline-block;float: right;text-align: right;margin-top: 4px;"><a href="#" id="clear_sig2" class=""><img width="50%" src="css/signature-clear-action.png"></a></div>
                </div>
                    <div id="content_s2">
                      <div id="page5_tr">
                          <div id="page3_tr_bk">
                            <div id="signatureparent2">
                                <div id="signature2"></div>
                            </div>
                          </div>
                       </div>
                    </div>
                    <div>
                    <div id="please_consignee">
                	   PLEASE ENTER CONSIGNEE SIGNATURE
                    </div>
                    <div id="signature_button2">
                        <table id="sig_table_2">
                            <tr>
                                <td width="15%" ><div><a href="#" id="back4" onClick="close_sig2()" class=""><img width="40%" src="css/signature-back-action.png"></a></div></td>
                                <td width="35%">
                                  <select id="comment_bol">
                                     <option value="1">OK</option>
                                     <option value="2">SHORTAGE/DAMAGE</option>
                                  </select>
                                </td>
                                <td width="17%"><div class="width_buttons"><a href="#" id="save_comment_action" onClick="" class=""><img width="77%" src="css/signature-comment-inactive.png"></a></div></td>
                                <td width="17%"><div class="width_buttons"><a href="#" id="save_signature2" class=""><img width="79%" src="css/signature-save-action.png"></a></div></td>
                                <td width="16%"><div class="width_buttons"><a href="#" id="back4_1" onClick="close_sig2()" class=""><img width="38%" src="css/signature-cancel-action.png"></a></div></td>
                            </tr>
                        </table>
                     </div>
                    <div id="loading_signature2"><img src="css/loading.gif" style="width:8%;margin-left:45%;" /></div>
                 </div>
             </div>
            <div hidden><input type="hidden" id="hidden_Signature2" name="hidden_Signature2" />
            </div>
            <div id="signature_print2" hidden></div>
    </div>
    
<!-- Page 4 --> 
    <div data-role="page" id="page4">
                <div data-role="header" data-position="fixed" data-tap-toggle="false">
                <div style="background-color: rgb(255, 255, 255); padding-top: 5%;"></div>
                		<table width="100%" style="background-color:#ED1A3B">
                              <tr>
                                <td width="15%" style="padding-left:5px"><div><a href="#mypanel"><img width="100%" src="css/menu_button.png" style="margin-top:0px; margin-bottom:0px"/></a></div></td>
                                <td><div id="title3">TRACKN'GO!</div></td>
                                <td align="right" style="padding:5px"><div id="load_shipment4"></div></td>
                              </tr>
                          </table>
                 </div>
                   <div id="header_message"></div>
                    <div id="please_consignee">
                	   SEND A CALL CHECK
                    </div>
  	<div id="message_body" class="inputstyle">
  		<div role="main" class="ui-content" style="padding-top: 0px;padding-left:5px;padding-right:5px">
        	<!--<p id="title_messages"><h1>Default Messages</h1></p>-->
              <!--<h2 style="margin-top: 0px;">Default Messages</h2> -->
                <div id="notification_message"></div>
                    <div id="choose_section">
                             <div id="custom_div">
                             	<div id="custom"><a href="#" id="select_custom" name="send_message" class="btn-class-send3" onClick="">CUSTOM</a></div>
                                <div id="template"><a href="#" id="select_template" name="send_message" class="btn-class-clear3" onClick="">TEMPLATE</a></div>
                             </div>
                             <div id="troubles_div">
                                <select id="troubles_">
                                     <option value="">Select Template Message</option>
                                     <option value="1">Traffic Jam</option>
                                     <option value="2">Flat Tire</option>
                                     <option value="3">Damaged Vehicle</option>
                                     <option value="4">Weather Problem</option>
                                </select>
                            </div>
                     </div>
                <div id="msg_hid">
                	<textarea cols="30" rows="10" name="troubles_msg" id="troubles_msg" placeholder="message here" ></textarea>
                </div>
                <div id="load_hid" hidden></div>
                <div id="load_hid2" hidden></div>
                <div id="buttons_section">
                    <div id="clear_section">
                    	<div id="clear_message_button"><a href="#" id="clear_message" name="send_message" class="btn-class-clear" onClick="">CLEAR</a></div>
                    </div>
                    <div id="send_section">
                        <div id="message_button"><a href="#" id="send_message" name="send_message" class="btn-class-send" onClick="sendfunction()">SEND</a></div>
                        <div id="loading_message"><img src="css/loading.gif" style="width:15%;margin-left:40%; margin-top:3%" /></div>
                    </div>
                </div>
     	</div>
     </div>
        <!--<div style="margin-left:10px"><a href="#page2_5" id="back_from_message" class="btn-class2" onClick="" >BACK</a></div>-->
       <div data-role="footer" data-position="fixed"> 
                       <table style="width: 100%; border-collapse:collapse">
                            <tr style="background-color:#ED1A3B">
                                <td style="width: 25%;text-align: center;"><div><a href="" id="backmessage" class=""><img width="80%" src="css/back_pic.png"></a></div></td>
                                <td style="width: 25%;"><div id="shipper_button1"><!--<a href="" id="sig_button11" name="a" class=""><img src="css/button2.png" width="100%"/></a>--></div></td>
								<td style="width: 25%;"><div id="consignee_button1"><!--<a href="" id="sig_button22" name="b" class=""><img id="img_gps" src="css/button3.png" width="100%"/></a>--></div></td>
                                <td style="width: 25%;"><div><!--<a href="" id="driver_message1" name="b" class="" onClick=""><img src="css/button4.png" width="100%"/></a>--></div></td>
                            </tr>
                       </table>
                </div>
        
   </div>
   
    <div data-role="page" id="page6">
        <div data-role="header">
                  <div style="background-color: rgb(255, 255, 255); padding-top: 3%;"></div>       	
                    <table width="100%">
                          <tr>
                            <td width="24%"><div><img width="100%" src="css/logo.png" style="margin-top:0px; margin-bottom:0px"/></div></td>
                            <td align="right" valign="top" style="padding:5px"><div id="full_name6"></div><div><a href="#" id="signout6" style="color:red">Sign Out</a></div></td>
                          </tr>
                      </table>
        </div>
        		<div>
                	<div style="display: inline-block; margin-bottom: 7px; margin-top:2px" id="header_comment"></div>
                    <div style="display: inline-block;float: right;text-align: right;margin-top: 4px;"><a href="#" id="clear_comment"  class=""><img width="50%" src="css/signature-clear-action.png"></a></div>
                </div>
        
                <div id="comment_hand_parent">
                	<div id="comment_hand"></div>
                </div>
                    <div id="please_comment">
                	   PLEASE ENTER A COMMENT TO ADD TO THE BOL
                    </div>
                        <div id="comment_button"><!--<a href="#" id="save_comment" class="btn-class3">SAVE COMMENT</a>-->
                                <table id="comment_table">
                                    <tr>
                                        <td width="15%" ><div><a href="#" id="back4" onClick="close_comment()" class=""><img width="40%" src="css/signature-back-action.png"></a></div></td>
                                        <td width="35%">
                                        <div id="disable_select">
                                          <select id="comment_bol2">
                                             <!--<option value="1">OK</option>-->
                                             <option value="2">SHORTAGE/DAMAGE</option>
                                          </select>
                                         </div>
                                        </td>
                                        <td width="17%"><div class="width_buttons"><a href="#" id="save_comment" class=""><img width="77%" src="css/signature-comment-action.png"></a></div></td>
                                        <td width="17%"><div class="width_buttons">&nbsp;<!--<a href="#" id="save_signature2" class=""><img width="80%" src="css/signature-save-action.png"></a>--></div></td>
                                        <td width="16%"><div class="width_buttons"><a href="#" id="back4_1" onClick="close_comment()" class=""><img width="38%" src="css/signature-cancel-action.png"></a></div></td>
                                    </tr>
                                </table>
                        </div>
                        <div id="loading_comment_hand"><img src="css/loading.gif" style="width:6%;margin-left:45%;" /></div>
                        <div id="comment_print" hidden></div>
                        <div hidden><input type="hidden" id="hidden_comment" name="hidden_comment" /></div>
            <div id="localstorage_trace" hidden></div>
    </div>

   <!-- BOL IMAGE PAGE -->
	
	<!---------------------------------- SCRIPTS ----------------- --------->
    <script src="js/jSignature.min.noconflict.js"></script>
		<script>
		var location_trace_interval;
		var chatInt;
		var active_loads_number;
		var driver_location_interval;
		var active_shipment;
		
		function load_history(){
			localStorage.inactive = 1;
			 location.href = '#page1_1';
			 setTimeout(function(){ 
				 $('#lol_item').hide();
				 $('#lol_item_inactive').show();
				 $('#active_ld').attr('src','css/active_inactive.png');
				 $('#history_ld').attr('src','css/history_active.png');
			 },0);
			};
			
		function active_loads(){
			localStorage.inactive = 0;
			 location.href = '#page1_1';
			 setTimeout(function(){ 
				 $('#lol_item').show();
				 $('#lol_item_inactive').hide();
				 $('#active_ld').attr('src','css/active_active.png');
				 $('#history_ld').attr('src','css/history_inactive.png');
			 },0);
			};
		
		
		$('#signout0, #signout0_2, #signout1, #signout2, #signout3, #signout5, #signout6').click(function(){
			 function onConfirm(button){
			   if(button == 1){
				   	clean_apple_id();
				   }else{
					   }
			}
			 navigator.notification.confirm(
			 	'Are you sure?',
				onConfirm,
				'Smith TracknGo',
				['Yes','No']
			 );
			});
			
		function signout_function(){
			 function onConfirm(button){
			   if(button == 1){
				   	clean_apple_id();
				   }else{
					   }
			}
			 navigator.notification.confirm(
			 	'Are you sure?',
				onConfirm,
				'Smith TracknGo',
				['Yes','No']
			 );
			};
			
			
		function alertCallback() {
			 //Nothing but needed to make custom alerts work
			}
		// To clean APPLE Id from server and avoid future notifications
		function clean_apple_id(){
			                location.href ="#page0";
							$.ajax({
									type: 'POST',
									//data: {token_device: token, driver_id: id},
									data: {token_device: "", driver_id: localStorage.user_id},
									url: ''+localStorage.save_url+'/saveid_apple.php',
									success: function(data){
										console.log(data);
										localStorage.removeItem('load_hid');
										localStorage.removeItem('start');
										localStorage.removeItem('finish');
										localStorage.removeItem('user_id');
										localStorage.removeItem('trace');
										localStorage.removeItem('name');
										localStorage.removeItem('message');
										localStorage.removeItem('comment');
										localStorage.removeItem('inactive');
										//location.reload();
										setTimeout(function(){location.href = "#page1";},0);
										$('#user_name').val("")
									},
									error: function(){
										 navigator.notification.alert(
											  'An error has occurred, Please try again',
											  alertCallback,
											  'Smith TracknGo',
											  'Ok');
										window.history.back();
										console.log(data);
									},
									timeout: 4000 // sets timeout to 3 seconds
									})
								};
		
		//NO shipper signature Added alert
		function consignee_alert(){
			  navigator.notification.alert(
			  'Get the Shipper Signature First',
			  alertCallback,
			  'Smith TracknGo',
			  'Ok');
			}
		
		// GO TO HANDMADE COMMENT ========= CONSIGNEE
		$('#comment_bol').on('change', function() {
			 if($('#comment_bol').val() == 2){
				 if(localStorage.comment == 0){
				    location.href = "#page6";
				  }else{
					  navigator.notification.alert(
						  'This can be done just once',
						  alertCallback,
						  'Smith TracknGo',
						  'Ok');
					  //$( "#comment_bol option:selected").val('1');
					 }
				 }
			});
			
			
			//--- Upload camera's Picture Function ---//
			function uploadPhoto() {
				  // Called if something bad happens.
    //
						$("#image_source").attr('src','css/loading2.gif');
										//selected photo URI is in the src attribute (we set this on getPhoto)
						var imageURI = $('#cam_picture').html();
						if (!imageURI) {
							 navigator.notification.alert(
										  'Please, take a picture first',
										  alertCallback,
										  'Smith TracknGo',
										  'Ok');
							return;
						}
				
						//set upload options
						var options = new FileUploadOptions();
						options.fileKey = "file";
						//options.fileName = imageURI.substr(imageURI.lastIndexOf('/')+1);
						var name_date = ($("#image_source").attr('alt')).substr(($('#image_source').attr('alt')).lastIndexOf("/")+1);
						var name_no_date = name_date.split("?"); // delete date in seconds from url
						options.fileName = name_no_date[0]; //($("#image_source").attr('alt')).substr(($('#image_source').attr('alt')).lastIndexOf("/")+1);
						options.mimeType = "image/jpeg";
						options.params = {
							firstname: 'first',
							lastname: 'second',
							workplace: 'workplace'
						}
				
						var ft = new FileTransfer();
						ft.upload(imageURI, encodeURI(localStorage.save_url+"/save_picture.php"), win, fail, options);
					}
											
						function win(r) {
								console.log("Code = " + r.responseCode);
								console.log("Response = " + r.response);
								//alert("Response =" + r.response);
								console.log("Sent = " + r.bytesSent);
								  navigator.notification.alert(
										  'The picture has been sent',
										  alertCallback,
										  'Smith TracknGo',
										  'Ok');
										  d = new Date();
								  $("#image_source").attr('src',$("#image_source").attr('alt')+d.getTime());
								  // Erase Picture when succeeding 
								  $('#cam_picture').html('');
								  // Hide Save pic Button
								  $('#save_pic').hide();
							}
						
						function fail(error) {
								alert("An error has occurred: Code = " + error.code);
								console.log("upload error source " + error.source);
								console.log("upload error target " + error.target);
							}
							
			// Save picture, sends the image to the server.				
			$('#save_picture').click(function(){
				  uploadPhoto();
				});
			// Save bol, Creates Pdf and save it for manager.
			//--- OnConfirm_signature changes function if the document is already signed. ---//
			 function onConfirm_signature(button){
				var unsigned_shipments = 0;
				if(button == 1){
							$.ajax({
									  type: 'POST',
									  async: false,
									  data:{pages_number:localStorage.pages,load_id:localStorage.load_id_bol,bol_number:localStorage.bol_number},
									  url: ''+localStorage.save_url+localStorage.save_bol+'',
									  success: function(data){
										   if(localStorage.signature == 0) {
													  localStorage.signature = 1;
													  $('#sig_button1').attr("href","#");
													  $('#sig_button1').html('<img src="css/button2s.png" width="100%"/>');
													  $('#consignee_button').html('<a href="#page5" id="sig_button2" name="b" class=""><img id="img_gps" src="css/button3.png" width="100%"/></a>');
													  $('#save_bol').show();
													  
												} else if(localStorage.signature == 1){
													  localStorage.completed = 1;
													  $('#save_bol').hide();
													   $('#consignee_button').html('<a href="#" id="sig_button2" name="b" class=""><img id="img_gps" src="css/button3s.png" width="100%"/></a>');
													   //----- ASK FOR DESTINATION EMPTY SIGNATURES-----//
																  $.ajax({
																	 type: 'POST',
																	 async:false,
																	 dataType: 'json',
																	 url:''+localStorage.base_url+'/load/app_get_shipments_by_load/'+localStorage.load_id_bol,
																	 success: function(data){
																			console.log(data);
																			for(i=0;i<data.length;i++){
																				if(data[i].destination_sign == 0){
																					 unsigned_shipments++;
																					}else{
																						}
																				}
																		},
																	error: function(data){
																		console.log(data);
																		navigator.notification.alert(
																									  'There was an error with active loads',
																									  alertCallback,
																									  'Smith TracknGo',
																									  'Ok');
																	}})						
																// Reset location traces sending //
																if(unsigned_shipments >= 1){
																	}else{
																			localStorage.start = 0;
																			localStorage.finish = 1;
																			// To enable the restart --- driver setinterval --- driver_location_interval
																			localStorage.location_mark = 0;
																			//-/-----/-//
																			localStorage.trace = 0;//$('#localstorage_trace').html(0);
																			clearInterval(location_trace_interval);
																			//clearInterval(driver_location_interval);
																			//alert('location_trace_deleted_2');
																			cordova.plugins.backgroundMode.disable();
																			bgGeo.stop();
																			//sigData.jSignature("reset");
																		};
													}
										   navigator.notification.alert(
																	  'BOL has been sent to Manager',
																	  alertCallback,
																	  'Smith TracknGo',
																	  'Ok');
										  console.log(data);
										  },
									  error: function(data){
										  navigator.notification.alert(
																	  'There was a problem, Try again',
																	  alertCallback,
																	  'Smith TracknGo',
																	  'Ok');
										  console.log(data);
										  }
									  });
									   }else{
										   
										   }
								};
								
			// Save BOL as a "signature"///
			$('#save_bol').click(function (){
				       //
				if(localStorage.signature == 0){
								 localStorage.save_bol = '/savebol.php';
								 navigator.notification.confirm(
									'Save Document Signed by the SHIPPER',
									onConfirm_signature,
									'Smith TracknGo',
									['Yes','No']
								 );
					}else if(localStorage.signature == 1){
								 localStorage.save_bol = '/savebol2.php';
								 navigator.notification.confirm(
									'Save Document Signed by the CONSIGNEE',
									onConfirm_signature,
									'Smith TracknGo',
									['Yes','No']
								 );
						}

				});
			
			//---BOL using CAMERA ---//
			$('#upload_picture').click(function(){
				localStorage.image_name = $("#image_source").attr('src');
				$("#image_source").attr('alt',localStorage.image_name);
				$("#image_source").attr('src','css/loading2.gif');
				navigator.camera.getPicture(onSuccess, onFail, { quality: 40,
								targetWidth: 1650,
								targetHeight: 2200,
								destinationType: Camera.DestinationType.FILE_URI
							});
							
							function onSuccess(imageURI) {
								//var image = document.getElementById('myImage');
								//image.src = "data:image/jpeg;base64," + imageData;
								//localStorage.camera = 1;
								$('#save_pic').show();
								$('#cam_picture').html(imageURI);
								setTimeout(function(){
									   //$('#bol_image').html('<img id="image_source" src="data:image/jpeg;base64,'+$('#cam_picture').html()+'" style="width:100%;padding-top:2px;"/>');
									   //$('#bol_image').html('<img id="image_source" src="'+$('#cam_picture').html()+'" style="width:100%;padding-top:2px;"/>');
									   $('#image_source').attr('src',$('#cam_picture').html());
									   setTimeout(function () {
											myScroll.refresh();
										}, 100);
									},0);
								
								 
							}
							
							function onFail(message) {
								//alert('Failed because: ' + message);
								// WHEN THE USER PRESS CANCEL --- not taking a photo.
								$("#image_source").attr('src',localStorage.image_name);
							}
			});
		// SHOW ACTIVE AND HISTORY LOADS

        $('#active_ld').click(function(){
				$('#active_ld').attr('src','css/active_active.png');
				$('#history_ld').attr('src','css/history_inactive.png');
				$('#lol_item').show();
				$('#lol_item_inactive').hide();
			});
		
		
        $('#history_ld').click(function(){
			    $('#active_ld').attr('src','css/active_inactive.png');
				$('#history_ld').attr('src','css/history_active.png');
				$('#lol_item').hide();
				$('#lol_item_inactive').show();
			});
		
		$('#digital_bol').click(function(){
			    //$('#chat_bol').attr('src','css/chat_inactive.png');
			    $('#digital_bol').attr('src','css/digital_active.png');
				$('#direction_bol').attr('src','css/places_inactive.png');
				$('#picture_bol').attr('src','css/picture_inactive.png');
				$('#picture_buttons').hide();
				$('#pick_drop').hide();
				$('#digital_buttons').show();
				$('#bol_image').show();
				// expandable menu
				/*if($('#doc_options').css('display') == 'block'){
				       $('#doc_options').css('display','none');
				}else{
					   $('#doc_options').css('display','block');
					}*/
				//-------
			});
		$('#picture_bol').click(function(){
			    //$('#chat_bol').attr('src','css/chat_inactive.png');
			    $('#digital_bol').attr('src','css/digital_inactive.png');
				$('#direction_bol').attr('src','css/places_inactive.png');
				$('#picture_bol').attr('src','css/picture_active.png');
				$('#picture_buttons').show();
				$('#pick_drop').hide();
				$('#digital_buttons').hide();
				$('#bol_image').show();
			});	
		$('#direction_bol').click(function(){
			    //$('#chat_bol').attr('src','css/chat_inactive.png');
			    $('#digital_bol').attr('src','css/digital_inactive.png');
				$('#direction_bol').attr('src','css/places_active.png');
				$('#picture_bol').attr('src','css/picture_inactive.png');
				//$('#picture_buttons').hide();
				$('#pick_drop').show();
				//$('#digital_buttons').hide();
				$('#bol_image').hide();
			});
		 $('#chat_bol, #chat_bol2').click(function(){
			    //$('#chat_bol').attr('src','css/chat_active.png');
				setTimeout(function(){
						location.href='#page4';
					},100);
				$('#direction_bol').attr('src','css/places_inactive.png');
				$('#picture_bol').attr('src','css/picture_inactive.png');
				$('#digital_bol').attr('src','css/digital_inactive.png');
				//$('#picture_buttons').hide();
				//$('#pick_drop').hide();
				//$('#digital_buttons').show();
				//$('#bol_image').hide();
			});		
		  						
		//------  VIEW BOL IMAGE ------//
		
		function view_bol(){
			 //$('#localstorage_trace').html(localStorage.trace);
				                //location.href='#page2_5';
								var bolh1 = (0.51)*parseFloat(window.screen.height);
								$('#bol_image').css("height",bolh1);
								setTimeout(function (){
									//alert('inside view bol')
										d = new Date();
										if(localStorage.inactive == 1){
											    $("#image_source").attr('src',''+localStorage.files+'/'+$('#load_hid').html()+'_bol_'+localStorage.bol_number+'-0.jpg?'+d.getTime()+'');
											}else{
										        $("#image_source").attr('src',''+localStorage.files+'/'+localStorage.load_id_bol+'_bol_'+localStorage.bol_number+'-0.jpg?'+d.getTime()+'');
											}
										//$('#bol_image').append('<div><img id="image_source2" src="css/loading2.gif" style="width:100%;padding-top:2px;"/></div>');
									 }, 100);
									 
								setTimeout(function () {
											myScroll.refresh();
									}, 500);
					}
		///-------- TRACE LOAD - Onpage2 ----///
		function trace_load(){
			//
			setTimeout(function(){
					if(parseFloat(localStorage.active_shipment_counter) >= 1){
							 localStorage.trace = 1;//$('#localstorage_trace').html(1);
							// alert('shipment counter>=1');
					}else{
							 localStorage.trace = 0; //$('#localstorage_trace').html(0);
							 // alert('shipment counter = 0');
						}
				},100); 
			
			   				//----- SEND TRACING LOCATION WHEN THE SHIPMENTS ARE DISPLAYED----///
				if(localStorage.finish == 1){
					//alert('localstorage finish = 1')
					}else{
/*Ask if already started sening trace */if(localStorage.start == 1){
												//alert('localstorage start = 1')
													}else{
														location_trace_interval = setInterval(function(){
															if(localStorage.trace == 1){
															navigator.geolocation.getCurrentPosition(onSuccess, onError);
																  function onSuccess(position) {
																	 var x = position.coords.latitude;
																	 var y = position.coords.longitude;
																		send_trace(x,y);
																		/*navigator.notification.alert(
																			  'Ok, I started sending the trace',
																			  alertCallback,
																			  'Smith TracknGo',
																			  'Ok');*/
																  };
																   function onError(error) {
																	    navigator.notification.alert(
																			  'GPS trace system is inactive',
																			  alertCallback,
																			  'Smith TracknGo',
																			  'Ok');
																	};
															}else{
																//alert('Im not sending the trace');
																}
													//WARNING
														 },80000);
													}
											}		
					};

		function trace_load2(){
						location_trace_interval = setInterval(function(){
						if(localStorage.trace == 1){
						navigator.geolocation.getCurrentPosition(onSuccess, onError);
							  function onSuccess(position) {
								 var x = position.coords.latitude;
								 var y = position.coords.longitude;
									send_trace(x,y);
									/*navigator.notification.alert(
										  'Ok, I started sending the trace',
										  alertCallback,
										  'Smith TracknGo',
										  'Ok');*/
							  };
							   function onError(error) {
									navigator.notification.alert(
										  'GPS trace system is inactive',
										  alertCallback,
										  'Smith TracknGo',
										  'Ok');
								};
						}else{
							  //alert('Im not sending the trace2');
							}
				       //WARNING
					 },80000);
			}
		///----------------------------------///
		<!-- MESSAGE TO DASHBOARD OPTIONS -->
		
	
	$('#troubles_').on('change', function() {
				switch($('#troubles_').val()){
					case '1' :
					  $("#troubles_msg").val('Traffic Jam');
					break;
					case '2' :
						$("#troubles_msg").val('Flat Tire');
					break;
					case '3' :
						$("#troubles_msg").val('Damaged Vehicle');
					break;
					case '4' :
						$("#troubles_msg").val('Weather Problem');
					break;
					}
	});

				
				
		$('#select_custom, #troubles_msg').click(function(){
				$('#select_custom').attr('class','btn-class-send');
				$('#select_template').attr('class','btn-class-clear');
				$('#choose_section').css('background-color','#5F5F5F');
				localStorage.message = 1;
			});
		$('#select_template, #troubles_').click(function(){
				$('#select_custom').attr('class','btn-class-clear');
				$('#select_template').attr('class','btn-class-send');
				$('#choose_section').css('background-color','#ED1A3B');
				localStorage.message = 0;
			});
		<!-- SEND MESSAGE TO WEB -->
		
		function sendfunction(){

			var custom;
			if (localStorage.message == 0 ){
				 if($('#troubles_').val() == ""){
					  navigator.notification.alert(
						  'Please Choose an Option',
						  alertCallback,
						  'Smith TracknGo',
						  'Ok');
				 }else{
					$('#message_button').hide();
					$('#loading_message').show();
					    $.ajax({ 
                            type: 'POST',
                            data: {load_id: localStorage.load_id_bol, message_id: $('#troubles_').val(), user_id : localStorage.user_id, message_text: $("textarea#troubles_msg").val(), lat_message: $('#latitude').val(), lng_message:$('#longitude').val(), bol_number:localStorage.bol_number},
                            url: ''+localStorage.save_url+'/sendmessage.php',
                            success: function(data){
                                console.log(data);
							    navigator.notification.alert(
								  'Your message Has been sent to the Manager',
								  alertCallback,
								  'Smith TracknGo',
								  'Ok');
								$('#message_button').show();
								$('#loading_message').hide();
								$("textarea#troubles_msg").val("");
                            },
                            error: function(){
                                console.log(data);
								 navigator.notification.alert(
								  'There was an error sending your message',
								  alertCallback,
								  'Smith TracknGo',
								  'Ok');
                            }})
					 }
				}
				
			//custom 
			if(localStorage.message == 1){
						if($("textarea#troubles_msg").val()==""){
							navigator.notification.alert(
								  'Please type a message',
								  alertCallback,
								  'Smith TracknGo',
								  'Ok');
							
						}else{
					       $('#message_button').hide();
					       $('#loading_message').show();
							custom=5;  
					$.ajax({ 
                            type: 'POST',
                            data: {load_id:localStorage.load_id_bol, message_id: custom, user_id : localStorage.user_id, message_text: $("textarea#troubles_msg").val(), lat_message: $('#latitude').val(), lng_message:$('#longitude').val()},
                            url: ''+localStorage.save_url+'/sendmessage.php',
                            success: function(data){
                                console.log(data);
								navigator.notification.alert(
								  'Your message Has been sent to the Manager',
								  alertCallback,
								  'Smith TracknGo',
								  'Ok');
								$('#message_button').show();
								$('#loading_message').hide();
								$("textarea#troubles_msg").val("");
                            },
                            error: function(){
                                console.log(data);
								navigator.notification.alert(
								  'There was an error sending your message',
								  alertCallback,
								  'Smith TracknGo',
								  'Ok');
                            }})
							 }
			}
		}
		
		//-------------- Send Location to DATABASE ------------------------
		function send_location(x,y){ 
                    var lati = x;
					$('#latitude').val(lati); // Use to show location when sending callcheck
                    var longi = y;
					$('#longitude').val(longi); // Use to show location when sending callcheck
					var name = localStorage.user_id;
					
                        $.ajax({
                            type: 'POST',
							data: {user_lat: lati, user_long: longi, user_name: name},
                            url: ''+localStorage.save_url+'/save.php',
                            success: function(data){
                                console.log(data);
                               // alert('Your location was successfully added');
							   bgGeo.finish();
                            },
                            error: function(){
                                console.log(data);
								navigator.notification.alert(
								  'There was an error sending to database',
								  alertCallback,
								  'Smith TracknGo',
								  'Ok');
                            }})
		}
		
		function send_trace(x,y){
					var lati = x;
					$('#latitude').val(lati); // Use to show location when sending callcheck
                    var longi = y;
					$('#longitude').val(longi); // Use to show location when sending callcheck
					var name = localStorage.user_id;
					
                        $.ajax({
                            type: 'POST',
							data: {user_lat: lati, user_long: longi, load_id:localStorage.load_id_bol},
                            url: ''+localStorage.save_url+'/save_trace.php',
                            success: function(data){
                                console.log(data);
                               // alert('Your location was successfully added');
							   bgGeo.finish();
                            },
                            error: function(){
                                console.log(data);
								navigator.notification.alert(
								  'There was an error sending to database',
								  alertCallback,
								  'Smith TracknGo',
								  'Ok');
                            }})
		}
			
		//---------------------------End ------------------
		function active_load(id_driver){
			                  var active_shipment;// Active shipments counter variable. //
							  var shipment_number; // Number of shipments, active or inactive.
							 $.ajax({
							 type: 'POST',
							 dataType: 'json',
							 url: ''+localStorage.base_url+'/load/app_get_load_by_driver/'+id_driver,
							success: function(data){
											console.log(data);
											active_loads_number = 0;
											$("#lol_item").html("");
											$("#lol_item").append('<tr><th width="33%"> DATE </th><th width="33%"> LOAD # </th><th width="33%"> SHIPMENTS </th></tr>');
											$("#lol_item_inactive").html("");
											$("#lol_item_inactive").append('<tr><th width="33%"> DATE </th><th width="33%"> LOAD # </th><th width="33%"> SHIPMENTS </th></tr>');
											if(localStorage.inactive == 1){
												     $('#lol_item').hide();
												}else{
													 $("#lol_item_inactive").hide();
													}
											for(i=0;i<data.length;i++){
												
												if((data[i].sw == 1)&&(data[i].tender == 1)){
													
													//-----Check  for every signature in the load to set active or inactive status.-----//
													$.ajax({
														type:'POST',
														dataType:'json',
														url:''+localStorage.base_url+'/load/app_get_shipments_by_load/'+data[i].idts_load,
														async:false,
														success: function(data_s){
															active_shipment = 0;
															shipment_number = 0;
																for(j=0;j<data_s.length;j++){
																	  if(data_s[j].destination_sign == '0'){
																			  active_shipment++;
																			  shipment_number++;
																		  }else{
																			  shipment_number++;
																			  };
																	};
																localStorage.active_shipment = active_shipment;
																console.log(data_s);
															},
														error: function(data_s){
															console.log(data_s);
															}
														});
														if(active_shipment >= 1){
															//alert('there is one active');
																active_loads_number++; //---- number of active loads. Check if there is any active. ----//
																$("#lol_item").append('<tr><td>'+data[i].date_created+'</td><td><a href="#" style="color: red;" class="" onclick="active_shipments_load('+data[i].idts_load+','+data[i].load_number+')"><h3>'+data[i].load_number+'</h3></a></td><td align="center">'+shipment_number+'</td></tr>');
															}else{
														//Change load detals. Just to see old BOL's
																$("#lol_item_inactive").append('<tr><td>'+data[i].date_created+'</td><td><a href="#" style="color: black;" class="" onclick="inactive_shipments_load('+data[i].idts_load+','+data[i].load_number+')"><h3>'+data[i].load_number+'</h3></a></td><td align="center">'+shipment_number+'</td></tr>');
																}
													} 
												}
												//localStorage.active_shipment = active_shipment;
											$('#loading_loads').html(""); //--Delete Loading Gif when all loads are checked. -----/
											
									//-------------- SEND REGISTER ID TO DATABASE --- ANDROID CLOUD MESSAGING --- PUSH
									setTimeout(function(){
										var token = localStorage.token; // $('#token_device_hid').html();
										var id = localStorage.user_id;
										$.ajax({
											type: 'POST',
											//data: {token_device: token, driver_id: id},
											data: {token_device: token, driver_id: id},
											async: false,
											url: ''+localStorage.save_url+'/saveid_apple.php',
											success: function(data){
												console.log(data);
											},
											error: function(){
												console.log(data);
											}})			
										},1000);
										//--------------------
										//---trace load adjustments----
									if(active_loads_number >= 1){
										// Start interval, just when new one arrives (or there is one active) //
											if(localStorage.location_mark == 1){
												}else{
													//alert('location 60 seconds');
													 driver_location_interval = setInterval(function(){
															navigator.geolocation.getCurrentPosition(onSuccess, onError);
																  function onSuccess(position) {
																	 var x = position.coords.latitude;
																	 var y = position.coords.longitude;
																	 send_location(x,y);
																	}
																   function onError(error) {
																	  navigator.notification.alert(
																		  'GPS access error',
																		  alertCallback,
																		  'Smith TracknGo',
																		  'Ok');
																	}
														 },60000);
													localStorage.location_mark = 1;
												}
										}
		 // Changed from 20 Seconds to 40 seconds Aprox. //20151008 changed to 60
										},
                            error: function(data){
                                console.log(data);
								navigator.notification.alert(
															  'There was an error with active loads',
															  alertCallback,
															  'Smith TracknGo',
															  'Ok');
                            }})
				};
				
		//------- LOAD SHIPMENTS -----//
		function active_shipments_load(load_id,load_number){
			               //----- After being Closed and Reopened ---//
						   if(localStorage.tobecontinued == 1){
							      trace_load2();
								  //alert('tobecontinued == 1')
								  localStorage.tobecontinued = 0;
							   }
						   //-----------------------------------------//
							 localStorage.active_shipment_counter = "";
				             var active_shipment_counter = 0;
							//---Markers for resets, traces and more---//
								localStorage.inactive = 0;
								//Activating Comment again
								localStorage.comment = 0;
								localStorage.start ="";
								localStorage.finish = 0;
								localStorage.load_hid = load_id;
							 //---END of Markers for resets, traces and more---//
							 location.href = '#page2';
							 localStorage.load_id_bol = load_id;
							 //---Last active Load ---// GO directly to last active load checked
							 localStorage.last_active_load = localStorage.load_id_bol;
							  //---END of Last active Load ---//
							 localStorage.load_number = load_number;
							 //---Last active Load NUMBER---// GO directly to last active load checked
							 localStorage.last_active_load_number = localStorage.load_number;
							 $.ajax({
							 type: 'POST',
							 async:false,
							 dataType: 'json',
							 url:''+localStorage.base_url+'/load/app_get_shipments_by_load/'+load_id,
							
	                            success: function(data){
	                                console.log(data);
									//active_loads_number = 0;
									//Load's number to guide the user. BOL's with current load number.
									$("#load_shipment, #load_shipment1, #load_shipment4").html(" LOAD # :"+'<a style="color:#fff" id="bol" href="#" x-apple-data-detectors="false">'+load_number+'</a>');
								    $("#lol_item_shipment").html("");
								    $("#lol_item_shipment").append('<tr><th width="33%"> DATE </th><th width="33%"> BOL # </th><th width="33%">&nbsp;</th></tr>');
									$("#lol_item_shipment_inactive").html("");
									$("#lol_item_shipment_inactive").append('<tr><th width="33%"> DATE </th><th width="33%"> BOL # </th><th width="33%">&nbsp;</th></tr>');
									$("#lol_item_shipment_inactive").hide();
									var pages;
									for(i=0;i<data.length;i++){
										if(data[i].destination_sign == 0){
											//Active shipment counter for trace control
											   active_shipment_counter++;
											   if(data[i].pages_number>1){pages = ' pages'}else{pages = ' page'}
												$("#lol_item_shipment").append('<tr><td>'+data[i].date_created+'</td><td><a href="#" style="color: red;" class="" onclick="bol_details('+data[i].ts_load_idts_load+','+data[i].bol_number+','+data[i].pages_number+','+data[i].origin_sign+','+data[i].destination_sign+')"><h3>'+data[i].bol_number+'</h3></a></td><td>'+data[i].pages_number+pages+'</td></tr>');
											//
											  localStorage.active_shipment_counter = active_shipment_counter;
											}else{
												//Change load detals. Just to see old BOL's
												if(data[i].pages_number>1){pages = ' pages'}else{pages = ' page'}
												$("#lol_item_shipment").append('<tr><td>'+data[i].date_created+'</td><td><a href="#" style="color: black;" class="" onclick="bol_details('+data[i].ts_load_idts_load+','+data[i].bol_number+','+data[i].pages_number+','+data[i].origin_sign+','+data[i].destination_sign+')"><h3>'+data[i].bol_number+'</h3></a></td><td>'+data[i].pages_number+pages+'</td></tr>');
												}
										}
									$('#loading_shipments').html("");
                                },
                            error: function(data){
                                console.log(data);
								navigator.notification.alert(
															  'There was an error with active loads',
															  alertCallback,
															  'Smith TracknGo',
															  'Ok');
                            }})
	    	};
//-------------------INACTIVE SHIPMENTS LOAD---------------------------//
		function inactive_shipments_load(load_id,load_number){
			                  localStorage.inactive = 1;
				              $('#load_hid').html(load_id);
				              location.href = "#page2";
							  //-----------------------
												 $.ajax({
												 type: 'POST',
												 async:false,
												 dataType: 'json',
												 url:''+localStorage.base_url+'/load/app_get_shipments_by_load/'+load_id,
													success: function(data){
														console.log(data);
														//active_loads_number = 0;
														//Load's number to guide the user. BOL's with current load number.
														$("#load_shipment, #load_shipment1, #load_shipment4").html(" LOAD # :"+'<a style="color:#fff" id="bol" href="#" x-apple-data-detectors="false">'+load_number+'</a>');
														$("#lol_item_shipment").html("");
														$("#lol_item_shipment").append('<tr><th width="33%"> DATE </th><th width="33%"> BOL # </th><th width="33%">&nbsp;</th></tr>');
														$("#lol_item_shipment_inactive").html("");
														$("#lol_item_shipment_inactive").append('<tr><th width="33%"> DATE </th><th width="33%"> BOL # </th><th width="33%">&nbsp;</th></tr>');
														$("#lol_item_shipment_inactive").hide();
														var pages;
														for(i=0;i<data.length;i++){
															if(data[i].destination_sign == 0){
																  //Active shipment counter for trace control
																   active_shipment_counter++;
																   if(data[i].pages_number>1){pages = ' pages'}else{pages = ' page'}
																	$("#lol_item_shipment").append('<tr><td>'+data[i].date_created+'</td><td><a href="#" style="color: red;" class="" onclick="bol_details('+data[i].ts_load_idts_load+','+data[i].bol_number+','+data[i].pages_number+','+data[i].origin_sign+','+data[i].destination_sign+')"><h3>'+data[i].bol_number+'</h3></a></td><td>'+data[i].pages_number+pages+'</td></tr>');
																	//
																	localStorage.active_shipment_counter = active_shipment_counter;
																}else{
																	//Change load detals. Just to see old BOL's
																	if(data[i].pages_number>1){pages = ' pages'}else{pages = ' page'}
																	$("#lol_item_shipment").append('<tr><td>'+data[i].date_created+'</td><td><a href="#" style="color: black;" class="" onclick="bol_details('+data[i].ts_load_idts_load+','+data[i].bol_number+','+data[i].pages_number+','+data[i].origin_sign+','+data[i].destination_sign+')"><h3>'+data[i].bol_number+'</h3></a></td><td>'+data[i].pages_number+pages+'</td></tr>');
																	}
															}
														$('#loading_shipments').html("");
													},
												error: function(data){
													console.log(data);
													navigator.notification.alert(
																  'There was an error with active loads',
																  alertCallback,
																  'Smith TracknGo',
																  'Ok');
												}})
								//-------------
							  
							          };
//--------------------UNCHANGED SHIPMENTS----------------------//
		function unchanged_shipments_load(load_id,load_number){
			                  localStorage.active_shipment_counter = "";
			                  var active_shipment_counter = 0;
     						//---Markers for resets, traces and more---//
							  localStorage.comment = 0;
					          localStorage.load_hid_2 = load_id;
							 //---END of Markers for resets, traces and more---//
							 location.href = '#page2';
							 localStorage.load_id_bol = load_id;
							 localStorage.load_number = load_number;
							 $.ajax({
							 type: 'POST',
							 async:false,
							 dataType: 'json',
							 url:''+localStorage.base_url+'/load/app_get_shipments_by_load/'+load_id,
	                            success: function(data){
	                                console.log(data);
									//active_loads_number = 0;
									//Load's number to guide the user. BOL's with current load number.
									$("#load_shipment, #load_shipment1, #load_shipment4").html(" LOAD # :"+'<a style="color:#fff" id="bol" href="#" x-apple-data-detectors="false">'+load_number+'</a>');
								    $("#lol_item_shipment").html("");
								    $("#lol_item_shipment").append('<tr><th width="33%"> DATE </th><th width="33%"> BOL # </th><th width="33%">&nbsp;</th></tr>');
									$("#lol_item_shipment_inactive").html("");
									$("#lol_item_shipment_inactive").append('<tr><th width="33%"> DATE </th><th width="33%"> BOL # </th><th width="33%">&nbsp;</th></tr>');
									$("#lol_item_shipment_inactive").hide();
									var pages;
									for(i=0;i<data.length;i++){
										if(data[i].destination_sign == 0){
											  //Active shipment counter for trace control
											   active_shipment_counter++;
											   if(data[i].pages_number>1){pages = ' pages'}else{pages = ' page'}
												$("#lol_item_shipment").append('<tr><td>'+data[i].date_created+'</td><td><a href="#" style="color: red;" class="" onclick="bol_details('+data[i].ts_load_idts_load+','+data[i].bol_number+','+data[i].pages_number+','+data[i].origin_sign+','+data[i].destination_sign+')"><h3>'+data[i].bol_number+'</h3></a></td><td>'+data[i].pages_number+pages+'</td></tr>');
											    //
												localStorage.active_shipment_counter = active_shipment_counter;
											}else{
												//Change load detals. Just to see old BOL's
												if(data[i].pages_number>1){pages = ' pages'}else{pages = ' page'}
												$("#lol_item_shipment").append('<tr><td>'+data[i].date_created+'</td><td><a href="#" style="color: black;" class="" onclick="bol_details('+data[i].ts_load_idts_load+','+data[i].bol_number+','+data[i].pages_number+','+data[i].origin_sign+','+data[i].destination_sign+')"><h3>'+data[i].bol_number+'</h3></a></td><td>'+data[i].pages_number+pages+'</td></tr>');
												}
										}
									$('#loading_shipments').html("");
                                },
                            error: function(data){
                                console.log(data);
								navigator.notification.alert(
											  'There was an error with active loads',
											  alertCallback,
											  'Smith TracknGo',
											  'Ok');
                            }})
			};
		//---------------------------Query DATA From SERVER  -------------------
			$('#login_phone').click(function(){
				$('#start_button').hide();
				$('#loading_start').show();
				var cont_2 = 0;
				var user_name = $('#user_name').val();
				//alert(user_name);
				$.ajax({
					 type: 'POST',
					 dataType: 'json',
					 url: ''+localStorage.base_url+'/driver/app_get',
					 success: function(data){
						 $('#start_button').show();
				         $('#loading_start').hide();
						 for(i=0;i<data.length;i++){
							 if (data[i].phone == user_name){
								 cont_2 = 1;
								 $('#hid_uid').html(data[i].idts_driver);
								 $('#full_name').html(data[i].full_name);
								 $('#full_name1').html(data[i].full_name);
								 $('#full_name0_2').html(data[i].full_name);
								 //$('#full_name2').html(data[i].full_name);
								 $('#full_name3').html(data[i].full_name);
								 $('#full_name4').html(data[i].full_name);
								 $('#full_name5').html(data[i].full_name);
								 $('#full_name6').html(data[i].full_name);
								 localStorage.name = data[i].full_name;
								 }
							 };
							  if (cont_2 == 1){
										localStorage.user_id = parseFloat($('#hid_uid').html());
										window.plugins.insomnia.keepAwake();
										//alert(localStorage.user_id)
										//active_load(localStorage.user_id);
										location.href = "#page1_1";
								 	}else{
										navigator.notification.alert(
										  'Invalid User',
										  alertCallback,
										  'Smith TracknGo',
										  'Ok');
									 }
						console.log(data);
					 },
					 error: function(){
						console.log(data);
						navigator.notification.alert(
								  'There was an error, Please try again',
								  alertCallback,
								  'Smith TracknGo',
								  'Ok');
					 }})
			 });
			

		//---Change BOL pages on click---//
		
           $('#nextpage_im').click(function(){
			   
			   if(localStorage.pages == 1){
				   }else{
			   $("#image_source").attr('src','css/loading2.gif');
			   //alert('Im inside');
				if((parseFloat(localStorage.cont_pages)) >= (parseFloat(localStorage.pages)-1)){
						localStorage.cont_pages = 0;
						$('#middle_number').html((parseFloat(localStorage.cont_pages)+1));
						//alert('Must reset');
					}else{
						localStorage.cont_pages = parseFloat(localStorage.cont_pages) + 1;
						$('#middle_number').html((parseFloat(localStorage.cont_pages)+1))
						//alert('Must be counting-'+localStorage.cont_pages);
					      }
				  
				  d = new Date();
			      setTimeout(function(){
					         if(localStorage.inactive == 1){
								    $("#image_source").attr('src',''+localStorage.files+'/'+$('#load_hid').html()+'_bol_'+localStorage.bol_number+'-'+localStorage.cont_pages+'.jpg?'+d.getTime()+'');
								 }else{
								    $("#image_source").attr('src',''+localStorage.files+'/'+localStorage.load_id_bol+'_bol_'+localStorage.bol_number+'-'+localStorage.cont_pages+'.jpg?'+d.getTime()+'');
							      };
							 }, 500);
			   }
			   });
			   
           $('#lastpage_im').click(function(){
			   
			   if(localStorage.pages == 1){
				   }else{
			   $("#image_source").attr('src','css/loading2.gif');
			   //alert('Im inside');
				if((parseFloat(localStorage.cont_pages)) == 0){
					    
						localStorage.cont_pages = (parseFloat(localStorage.pages)-1);
						$('#middle_number').html((parseFloat(localStorage.cont_pages)+1));
						//alert('Must reset');
					}else{
						localStorage.cont_pages = parseFloat(localStorage.cont_pages) - 1;
						$('#middle_number').html((parseFloat(localStorage.cont_pages)+1));
						//alert('Must be counting-'+localStorage.cont_pages);
					      }
				  
				  d = new Date();
			      setTimeout(function(){
								if(localStorage.inactive == 1){
								    $("#image_source").attr('src',''+localStorage.files+'/'+$('#load_hid').html()+'_bol_'+localStorage.bol_number+'-'+localStorage.cont_pages+'.jpg?'+d.getTime()+'');
								 }else{
								    $("#image_source").attr('src',''+localStorage.files+'/'+localStorage.load_id_bol+'_bol_'+localStorage.bol_number+'-'+localStorage.cont_pages+'.jpg?'+d.getTime()+'');
							      };
							 }, 500);
				   }
			   });
		
		// Load BOL details -----///
	
           function bol_details(load_id,bol_number,pages_number,origin,destination){
			        if(origin == 0){
						     localStorage.signature = 0; // SAVE BOL button ask to saving shipper signature
						}else{
						     localStorage.signature = 1; // SAVE BOL button ask to saving consignee signature
						 }
					 if(destination == 1){
						     $('#save_bol').hide();
							 localStorage.completed = 1;
						 }else{
							 $('#save_bol').show();
							 localStorage.completed = 0;
							 }
			   		//--- Clicks counter to change pages ---//
					localStorage.cont_pages = 0;
			   		//----BUTTON to change pages----//
						if(pages_number >= 2){
							       $('#next_page').show();
								   $('#next_page2').show();
							  }else{
							       $('#next_page').hide();
								   $('#next_page2').hide();	
								};
					//--- Number of pages for this BOL. --//		
				    localStorage.pages = pages_number;
					//----BOL Number for image drawing.
					localStorage.bol_number = bol_number;
					//------------------------------//
			   		$("#image_source").attr('src','css/loading2.gif');
			        //localStorage.trace = 1;
			   		$('#load_hid').html(load_id);
					$('#sig_button1').attr("href","#page3");
					$('#sig_button1').html('<img src="css/button2.png" width="100%"/>');
					//$('#sig_button1').attr("href","#");
					$('#sig_button2').attr("href","#page5");
					$('#sig_button2').html('<img src="css/button3.png" width="100%"/>');
					
				   location.href = "#page2_5";
                    var latitude_driver = parseFloat($('#latitude').val());//37.55;
                    var longitude_driver = parseFloat($('#longitude').val());//-77.44;
		    		var id_driver = $('#user_name').val();
					  //alert('bol_details clicked');
                        $.ajax({
                            type: 'POST',
			    			dataType: 'json',
                            url: ''+localStorage.base_url+'/load/app_get_shipments_by_load/'+load_id,
                            success: function(data){
								 //alert('shipment-'+load_id+'-success');
                            console.log(data);
					       for(i=0;i<data.length;i++){
							   //alert('inside the "for"');
								if(data[i].bol_number == bol_number){
									//alert('bol number number');
											var bolh = (0.51)*parseFloat(window.screen.height);
											$('#bol_image').css("height",bolh);
											$("#header_load").html("BOL # :"+'<a id="bol" href="#" x-apple-data-detectors="false">'+data[i].bol_number+'</a>');
											if(parseFloat(localStorage.pages)>1){
												       $('#header_load_pages').html(localStorage.pages+' pages');
												}else{
													   $('#header_load_pages').html(localStorage.pages+' page');
													}
												
											//alert('Hello bol number-'+data[i].bol_number+'-');
											//$('#load_number_hid').html(data[0].load_number);
											//---GETTING ADDRESS --- //
											localStorage.pick_address = 'maps://?q='+''+data[i].pickup_address+'';
											$('#pickup_text').html(data[i].pickup_address);
											localStorage.drop_address = 'maps://?q='+''+data[i].drop_address+'';
											$('#drop_text').html(data[i].drop_address);
											$("#bol_number_hid").html(data[i].bol_number);
											if (data[i].origin_sign != 0){
													  $('#sig_button1').attr("href","#");
													  $('#sig_button1').html('<img src="css/button2s.png" width="100%"/>'); 
													  $('#consignee_button').html('<a href="#page5" id="sig_button2" name="b" class=""><img id="img_gps" src="css/button3.png" width="100%"/></a>');
												}else{
													 $('#consignee_button').html('<a href="#" id="sig_button2" name="b" onClick="consignee_alert()"><img id="img_gps" src="css/button3.png" width="100%"/></a>');
													}
											if(data[i].destination_sign != 0){
												  $('#sig_button2').attr("href","#");
												  $('#sig_button2').html('<img src="css/button3s.png" width="100%"/>'); 
												    }
											d = new Date();
											setTimeout(function(){
												//alert('inside bol_details');
													$("#image_source").attr('src',''+localStorage.files+'/'+data[i].ts_load_idts_load+'_bol_'+data[i].bol_number+'-0.jpg?'+d.getTime()+'');
												 }, 500);
									
									}
								}

                            },
                            error: function(data){
                                console.log(data);
								navigator.notification.alert(
								  'There was an error loading the details',
								  alertCallback,
								  'Smith TracknGo',
								  'Ok');
                            }})
                       
                      //return false;
                };
						  
//----------------------END OF   Map, Distance , Time ------------------------------
	/* SIGNATURE DETAILS
	*/
	function close_sig(){
		$("#signatureparent").html("");
		screen.lockOrientation('portrait');
		location.href='#page2_5';
		}
		
	function close_sig2(){
		$("#signatureparent2").html("");
		screen.lockOrientation('portrait');
		location.href='#page2_5';
		}
	function close_comment(){
		$("#comment_hand_parent").html("");
		screen.lockOrientation('landscape');
		location.href='#page5';
		}
	
	(function($){
		$('#backmessage').click(function(){
		     clearInterval(chatInt);
			 //alert('reset chat');
			location.href ="#page2_5";
			});
/*		function chatIntC(){
			clearInterval(chatInt);
			location.href ="#page2_5";
			
		}
*/
		$('#page4').on('pageshow',function(e,data){
			// Show callcheck in left panel.
			//$('#callcheck_li').show();
			//var chatInt;
			localStorage.message = 1;
			$('#troubles_-button').css('font-size','13px');
			$('#troubles_-button').attr('class','ui-btn ui-icon-carat-d ui-corner-all ui-shadow');
			$('#troubles_-button').css('padding','10px');
			$('#troubles_-button').css('color', '#626262');
			$('#troubles_msg').attr('class','');
		    
			$('#message_body').css('height',(0.71*parseFloat(window.screen.height)));
		    $('#notification_message').css('height',(0.3*parseFloat(window.screen.height)));
			/*setTimeout(function () {
									myScroll_message.refresh();
										}, 500);*/
			//localStorage.msg = 0;
			//localStorage.bol = 0;
			$('#message_button').show();
			$('#loading_message').hide();
			$('#header_message').html('LOAD #: '+'<a id="bol4" href="#" x-apple-data-detectors="false">'+localStorage.load_number+'</a>');
		
		$('#clear_message').click(function(){
			$('#troubles_msg').val('')
			});
		
		
		cordova.plugins.backgroundMode.enable();
		//$('#msg_hid').hide();
		// ----- START CHAT when showing page ------//
		$.ajax({
							type: 'POST',
							dataType: 'json',
							url: ''+localStorage.base_url+'/load/get_chat/'+parseFloat(localStorage.load_id_bol)+'/1',
							success: function(data){
								$("#notification_message").html("");
								console.log(data);
								for(i=0;i<data.length;i++){
								if ((data[i].driver_sw == '0')&&(data[i].notify_driver =='1')){
									$("#notification_message").append('<p class="pmanager">'+data[i].user_login+' : '+data[i].comment+'</p><br><br>');
								} else if ((data[i].driver_sw == '1')) {
									$("#notification_message").append('<p class="pdriver">'+data[i].driver_name+' : '+data[i].comment+'</p><br><br>');
								}
									
								}
								$('#notification_message').scrollTop($('#notification_message')[0].scrollHeight);
								/*setTimeout(function () {
											myScroll_message.refresh();
										}, 500);*/
							},
							error: function(data){
								console.log(data);
							}});
							
		// ----- END OF ---- START CHAT when showing page ------//	
						
	chatInt = setInterval(function(){
						$.ajax({
							type: 'POST',
							dataType: 'json',
							url: ''+localStorage.base_url+'/load/get_chat/'+localStorage.load_id_bol+'/1',
								success: function(data){
								$("#notification_message").html("");
								console.log(data);
								for(i=0;i<data.length;i++){
								if ((data[i].driver_sw == '0')&&(data[i].notify_driver =='1')){
									$("#notification_message").append('<p class="pmanager">'+data[i].user_login+' : '+data[i].comment+'</p><br><br>');
								} else if ((data[i].driver_sw == '1')) {
									$("#notification_message").append('<p class="pdriver">'+data[i].driver_name+' : '+data[i].comment+'</p><br><br>');
								}
								}
							},
							error: function(data){
								console.log(data);
							}});
					
							$('#notification_message').scrollTop($('#notification_message')[0].scrollHeight);
							/*setTimeout(function () {
											myScroll_message.refresh();
										}, 500);*/
						}, 10000);
						

			
					});
	
	// ------ SAVING SHIPPER SIGNATURE ------//
	$('#save_signature').click(function(){
		    $('#loading_signature').show();
			$('#signature_button').hide();
            var sigData = $('#signature').jSignature('getData','base30');
            $('#hidden_Signature').val(sigData);
			var simage = new Image();
			simage.src = $('#signature').jSignature('getData');
			$("#signature_print").html(simage.src);
			$.ajax({
					type: 'POST',
					data: {bol_number:localStorage.bol_number, load_id:localStorage.load_id_bol, sig_print:$("#signature_print").html(), pages_number:localStorage.pages},
					url: ''+localStorage.save_url+'/save_sig.php',
					success: function(data){
						console.log(data);
						$('#save_bol').hide();
						$('#sig_button1').attr("href","#");
						$('#sig_button1').html('<img src="css/button2s.png" width="100%"/>');
						$('#consignee_button').html('<a href="#page5" id="sig_button2" name="b" class=""><img id="img_gps" src="css/button3.png" width="100%"/></a>');
						message_signature(localStorage.load_id_bol,1,localStorage.bol_number);
						//sigData.jSignature("reset");
					},
					error: function(data){
						console.log(data);
					}})
			});
			
	// ------ SAVING DELIVERY SIGNATURE ------//
	$('#save_signature2').click(function(){
			var unsigned_shipments = 0;
			$('#loading_signature2').show();
			$('#signature_button2').hide();
            var sigData = $('#signature2').jSignature('getData','base30');
            $('#hidden_Signature2').val(sigData);
			var simage2 = new Image();
			simage2.src = $('#signature2').jSignature('getData');
			$("#signature_print2").html(simage2.src);
			$.ajax({
					type: 'POST',
					async: false,
					data: {bol_number:localStorage.bol_number,load_id:localStorage.load_id_bol,sig_print:$("#signature_print2").html(), pages_number:localStorage.pages},
					url: ''+localStorage.save_url+'/save_sig2.php',
					success: function(data){
						console.log(data);
						$('#save_bol').hide();
						$('#sig_button2').attr("href","#");
						$('#sig_button2').html('<img src="css/button3s.png" width="100%"/>');
						message_signature(localStorage.load_id_bol,2,localStorage.bol_number);
						
						//----- ASK FOR DESTINATION EMPTY SIGNATURES-----//
                          $.ajax({
							 type: 'POST',
							 async:false,
							 dataType: 'json',
							 url:''+localStorage.base_url+'/load/app_get_shipments_by_load/'+localStorage.load_id_bol,
	                         success: function(data){
	                                console.log(data);
									for(i=0;i<data.length;i++){
										if(data[i].destination_sign == 0){
											 unsigned_shipments++;
											}else{
												}
										}
                                },
                            error: function(data){
                                console.log(data);
								navigator.notification.alert(
															  'There was an error with active loads',
															  alertCallback,
															  'Smith TracknGo',
															  'Ok');
                            }})						
						// Reset location traces sending //
						if(unsigned_shipments >= 1){
							}else{
									localStorage.start = 0;
									localStorage.finish = 1;
									// To enable the restart --- driver setinterval --- driver_location_interval
									localStorage.location_mark = 0;
									//-/-----/-//
									localStorage.trace = 0;//$('#localstorage_trace').html(0);
									clearInterval(location_trace_interval);
									//clearInterval(driver_location_interval);
									//alert('location_trace_deleted_2');
									cordova.plugins.backgroundMode.disable();
									bgGeo.stop();
									//sigData.jSignature("reset");
								};
						
					},
					error: function(data){
						console.log(data);
					}})
			});
	
			
	//------------SAVING CONSIGNEE COMMENT -----//	
	$('#save_comment').click(function(){
			$('#loading_comment_hand').show();
		    $('#comment_button').hide();
            var sigData = $('#comment_hand').jSignature('getData','base30');
            $('#hidden_comment').val(sigData);
			var simage3 = new Image();
			simage3.src = $('#comment_hand').jSignature('getData');
			$("#comment_print").html(simage3.src);
			$.ajax({
					type: 'POST',
					data: {comment_hand:$('#hidden_comment').val(),load_id:localStorage.load_id_bol,comment_print:$("#comment_print").html(),bol_number:localStorage.bol_number},
					url: ''+localStorage.save_url+'/save_comment_hand.php',
					success: function(data){
						console.log(data);
						
						function alertCallback0(){
							location.href='#page5';
						}
						navigator.notification.alert(
								  'Comment added to the BOL',
								  alertCallback0,
								  'Smith TracknGo',
								  'Ok');
						//sigData.jSignature("reset");
						$("#comment_hand_parent").html("")
						//back button
						$('#back4').hide();
						//cancel button
						$('#back4_1').hide();
						$('#save_comment_action').html('<img width="77%" src="css/signature-comment-inactive.png">');
						localStorage.comment = 1;
						//sigData.jSignature("reset");
					},
					error: function(data){
						console.log(data);
					}})
		});
		
	//----------Function for saving signature message to callchecks
	function message_signature(lid,sig,bol){
									//alert(lid+'-'+sig)
							  // ------------Message to signature saving 
									$.ajax({
										type: 'POST',
										data: {load_id:localStorage.load_id_bol, sig_id: sig, bol_number:localStorage.bol_number, user_id: localStorage.user_id, lat_sig: $('#latitude').val(), lng_sig:$('#longitude').val()},
										url: ''+localStorage.save_url+'/message_signature.php',
										success: function(data){
													//$('#sig_button1').attr("href","#");
													function alertCallback1(){
															if(sig == 2){
																   clearInterval(driver_location_interval);
																   //alert('driver location cleared');
																}else{
																	//alert('not cleared');
																	}
															location.href='#page2_5';
															screen.lockOrientation('portrait');	
														}
														
													navigator.notification.alert(
														  'Signature Saved',
														  alertCallback1,
														  'Smith TracknGo',
														  'Ok');
											},
										error: function(data){
											},
										})
						// -----------End of message to signature saving
		}
		
	//----------END OF Function for saving signature
	
	$('#page2_5').on('pageshow',function(e,data) {
		$('#middle_number').html('1');
		$('#doc_options').css('display','none');
		$('#digital_bol').attr('src','css/digital_active.png');
		$('#direction_bol').attr('src','css/places_inactive.png');
		$('#picture_bol').attr('src','css/picture_inactive.png');
		//$('#chat_bol').attr('src','css/chat_inactive.png');
		//$('#picture_buttons').hide();
		//$('#pick_drop').hide();
		$('#digital_buttons').show();
		$('#bol_image').show();
		//HIDE picture buttons
		$('#picture_buttons').hide();
		// HIDE directions
		$('#pick_drop').hide();
		// Starts save pic button hidden //
		$('#save_pic').hide();
		// Avoid allowing signatures on messages
		view_bol();
				
		//load_details_unchange($('#load_hid').html(), localStorage.load_id_bol);
		$('#back4').show();

	})
	
	$('#page3').on('pageshow',function(e,data) {
	//	localStorage.msg = 0;
	//	localStorage.bol = 0;
		$('#loading_signature').hide();
		$('#signature_button').show();
		$('#header_signature_1').html('BOL #: '+'<a id="bol2" href="#" x-apple-data-detectors="false">'+localStorage.bol_number+'</a>');
		screen.lockOrientation('landscape');
		setTimeout(function(){
				$("#signatureparent").html('<div id="signature"></div>');
				//$("#signature").html("");
				var $sigdiv1 = $("#signature").jSignature({'UndoButton':false});
				//d = new Date();
					$('#clear_sig1').click(function(){
						$sigdiv1.jSignature('reset');
					});
				$('#page3_tr').css('background-image','url('+localStorage.files+'/'+localStorage.load_id_bol+'_bol_'+localStorage.bol_number+'-0.jpg)');			
			},1000);
	
		setTimeout(function(){
		    $("#page3").css("min-height","0px");	
		},500);
	})
	
	$('#page5').on('pageshow',function(e,data) {
		//$('#comment_bol').val('2');
		//$( "#comment_bol option:selected").val('1');
		$('#comment_bol-button').css('font-size','13px');
		$('#comment_bol-button').attr('class','ui-btn ui-icon-carat-d ui-corner-all ui-shadow');
		$('#comment_bol-button').css('padding','3px');
		//localStorage.msg = 0;
		//localStorage.bol = 0;
		$('#loading_signature2').hide();
		$('#signature_button2').show();
		$('#header_signature_2').html('BOL #: '+'<a id="bol3" href="#" x-apple-data-detectors="false">'+localStorage.bol_number+'</a>');
		screen.lockOrientation('landscape');
		setTimeout(function(){
				$("#signatureparent2").html('<div id="signature2"></div>');
				//$("#signature2").html("");
				var $sigdiv2 = $("#signature2").jSignature({'UndoButton':false});
				$('#clear_sig2').click(function(){
					$("#signature2").jSignature('reset')
				});	
				//d = new Date();
				$('#page5_tr').css('background-image','url('+localStorage.files+'/'+localStorage.load_id_bol+'_bol_'+localStorage.bol_number+'-0.jpg)');
			},1000);
			
		
		setTimeout(function(){
		$("#page5").css("min-height","0px");	
		},500);


	})
	
	$('#page6').on('pageshow',function(e,data) {
		//Change select style
		$('#comment_bol2-button').css('font-size','13px');
		$('#comment_bol2-button').attr('class','ui-btn ui-icon-carat-d ui-corner-all ui-shadow');
		$('#comment_bol2-button').css('padding','3px');
		//Disable click on select OK SHORTAGE/DAMAGE
		$("#disable_select *").attr("disabled", "disabled").off('click');
		//-------
		$('#loading_comment_hand').hide();
		$('#comment_button').show();
		$('#header_comment').html('BOL #: '+'<a id="bol4" href="#" x-apple-data-detectors="false">'+$("#bol_number_hid").html()+'</a>');
		screen.lockOrientation('landscape');
		setTimeout(function(){
			$("#comment_hand_parent").html('<div id="comment_hand"></div>');
			//$("#comment_hand").html("");
			//var $sigdiv = $("#comment_hand").jSignature({'height':(0.5*parseFloat(window.screen.height)),'width':'100%','UndoButton':true});
			var $sigdiv3 = $("#comment_hand").jSignature({'UndoButton':false});
				$('#clear_comment').click(function(){
					$("#comment_hand").jSignature('reset')
				})
		},1000);
		setTimeout(function(){
			$("#page6").css("min-height","0px");	
		},500);
		
		
	})
	
	$('#page1_1').on('pageshow',function(e,data) {
		active_load(localStorage.user_id);
		cordova.plugins.backgroundMode.enable();
	    });
		
$('#page2').on('pageshow',function(e,data){
//-----------------------------------------	
				if(localStorage.inactive == 1){
					}else{
						if(localStorage.load_hid == localStorage.load_hid_2){
							}else{
						   // alert('trace_load activated')
						   	trace_load();
						}
					}
		if(localStorage.inactive == 1){}else{
//------------
        unchanged_shipments_load(localStorage.load_id_bol,localStorage.load_number);
//------------
		if ((localStorage.start == 1)){
				}else{
			setTimeout(function(){
				//--- Start location intervals Just Once ---- Mark ----//
					  localStorage.start = 1;
					},100);
				}
		localStorage.load_hid = localStorage.load_hid_2;
//-----------------------------------------	
		}
		});
		
		$("select option:contains('Value a')").attr("disabled","disabled")
		
	})(jQuery)
</script>

  </body>
</html>
